<div class="font-bold text-sm text-slate-800 mb-2 px-4">MATERIALS INCLUDED IN BID: {{ materials_brand }}</div>

{% for section_name in materials_section_order %}
{% set items = materials_sections.get(section_name, []) %}
<div class="px-4 mb-3">
    <div class="flex items-center justify-between mb-1">
        <span class="font-bold text-sm text-slate-700">{{ section_name }}</span>
        <form hx-post="/spec/material/section/delete"
              hx-target="#spec-materials-body"
              hx-swap="innerHTML"
              class="inline">
            <input type="hidden" name="section" value="{{ section_name }}">
            <button type="submit"
                    class="text-slate-300 hover:text-red-500 transition-colors"
                    title="Delete section"
                    onclick="return confirm('Delete section {{ section_name }} and all its items?')">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </form>
    </div>
    <table class="w-full text-sm border-collapse">
        {% for item in items %}
        <tr class="border border-slate-200">
            <td class="px-2 py-1 border border-slate-200">
                <form class="m-0"
                      hx-post="/spec/material/name"
                      hx-swap="none"
                      hx-trigger="change from:find input, keyup changed delay:500ms from:find input">
                    <input type="hidden" name="section" value="{{ section_name }}">
                    <input type="hidden" name="index" value="{{ loop.index0 }}">
                    <input type="text" name="name" value="{{ item.name }}"
                           class="w-full text-xs px-1 py-0.5 border-0 focus:ring-1 focus:ring-blue-500/50 focus:outline-none rounded bg-transparent">
                </form>
            </td>
            <td class="px-2 py-1 border border-slate-200 w-1/3">
                <form class="m-0"
                      hx-post="/spec/material/value"
                      hx-swap="none"
                      hx-trigger="change from:find input, keyup changed delay:500ms from:find input">
                    <input type="hidden" name="section" value="{{ section_name }}">
                    <input type="hidden" name="index" value="{{ loop.index0 }}">
                    <input type="text" name="value" value="{{ item.value }}"
                           class="w-full text-xs px-1 py-0.5 border-0 focus:ring-1 focus:ring-blue-500/50 focus:outline-none rounded bg-slate-50">
                </form>
            </td>
            <td class="px-2 py-1 border border-slate-200 w-10 text-center">
                <form hx-post="/spec/material/delete"
                      hx-target="#spec-materials-body"
                      hx-swap="innerHTML"
                      class="inline">
                    <input type="hidden" name="section" value="{{ section_name }}">
                    <input type="hidden" name="index" value="{{ loop.index0 }}">
                    <button type="submit"
                            class="text-slate-300 hover:text-red-500 transition-colors"
                            title="Delete">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>

    <!-- Add Item -->
    <div x-data="{ showAdd: false }" class="mt-1">
        <div x-show="!showAdd">
            <button type="button" @click="showAdd = true"
                    class="text-xs text-slate-500 hover:text-slate-700 flex items-center gap-1">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                Add Item
            </button>
        </div>
        <div x-show="showAdd" x-cloak>
            <form class="flex items-center gap-2"
                  hx-post="/spec/material/add"
                  hx-target="#spec-materials-body"
                  hx-swap="innerHTML"
                  @htmx:after-request="showAdd = false">
                <input type="hidden" name="section" value="{{ section_name }}">
                <input type="text" name="name" required placeholder="Material name"
                       class="flex-1 px-2 py-1 text-xs border border-slate-300 rounded focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500">
                <button type="submit"
                        class="px-2 py-1 bg-slate-800 text-white text-xs rounded hover:bg-slate-700">
                    Add
                </button>
                <button type="button" @click="showAdd = false"
                        class="px-2 py-1 bg-slate-100 text-slate-600 text-xs rounded hover:bg-slate-200">
                    Cancel
                </button>
            </form>
        </div>
    </div>
</div>
{% endfor %}

<!-- Add Section -->
<div class="px-4 pt-2 pb-3 border-t border-slate-200" x-data="{ showAdd: false }">
    <div x-show="!showAdd">
        <button type="button" @click="showAdd = true"
                class="text-xs text-slate-500 hover:text-slate-700 flex items-center gap-1 font-semibold">
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            Add Section
        </button>
    </div>
    <div x-show="showAdd" x-cloak>
        <form class="flex items-center gap-2"
              hx-post="/spec/material/section/add"
              hx-target="#spec-materials-body"
              hx-swap="innerHTML"
              @htmx:after-request="showAdd = false">
            <input type="text" name="name" required placeholder="Section name"
                   class="flex-1 px-2 py-1 text-xs border border-slate-300 rounded focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500">
            <button type="submit"
                    class="px-2 py-1 bg-slate-800 text-white text-xs rounded hover:bg-slate-700">
                Add
            </button>
            <button type="button" @click="showAdd = false"
                    class="px-2 py-1 bg-slate-100 text-slate-600 text-xs rounded hover:bg-slate-200">
                Cancel
            </button>
        </form>
    </div>
</div>
