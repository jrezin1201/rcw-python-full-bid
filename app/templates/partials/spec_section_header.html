<div class="flex items-center gap-2.5 min-w-0">
    {% if section_index is defined %}
    <span class="inline-flex h-6 w-6 items-center justify-center rounded-md bg-white border border-slate-200 text-xs font-semibold text-slate-700 shrink-0">{{ section_index }}</span>
    {% endif %}
    <span class="font-semibold text-sm text-slate-900 shrink-0">{{ section_name }}</span>
    <span class="text-xs text-slate-500 shrink-0">{{ section_total.item_count }} items</span>

    {% if section_label %}
    <span class="ml-1 px-2.5 py-0.5 bg-blue-50 text-blue-700 font-semibold text-[10px] uppercase rounded tracking-wide shrink-0 border border-blue-200">{{ section_label }}</span>
    {% endif %}
</div>

<div class="flex items-center gap-3 shrink-0" x-data="{
    mode: '{{ 'preset' if section_label == 'Flat One Tone' else ('custom' if section_label else 'blank') }}',
    customText: '{{ section_label if section_label and section_label != 'Flat One Tone' else '' }}'
}">
    <select
        class="h-8 bg-white text-slate-700 text-sm rounded-md border border-slate-200 px-2 focus:ring-1 focus:ring-blue-500"
        @change="
            if ($event.target.value === '') {
                mode = 'blank';
                customText = '';
                $refs.labelForm.querySelector('[name=label]').value = '';
                htmx.trigger($refs.labelForm, 'submit');
            } else if ($event.target.value === 'Flat One Tone') {
                mode = 'preset';
                customText = '';
                $refs.labelForm.querySelector('[name=label]').value = 'Flat One Tone';
                htmx.trigger($refs.labelForm, 'submit');
            } else if ($event.target.value === '__custom__') {
                mode = 'custom';
                $nextTick(() => $refs.customInput.focus());
            }
        "
    >
        <option value="" {{ 'selected' if not section_label }}>-- Label --</option>
        <option value="Flat One Tone" {{ 'selected' if section_label == 'Flat One Tone' }}>Flat One Tone</option>
        <option value="__custom__" {{ 'selected' if section_label and section_label != 'Flat One Tone' }}>Custom...</option>
    </select>

    <template x-if="mode === 'custom'">
        <div class="flex items-center gap-1">
            <input type="text" x-ref="customInput" x-model="customText" placeholder="Enter label"
                   class="h-8 bg-white text-slate-700 text-sm rounded-md border border-slate-200 px-2 w-28 focus:ring-1 focus:ring-blue-500"
                   @keydown.enter.prevent="
                       $refs.labelForm.querySelector('[name=label]').value = customText;
                       htmx.trigger($refs.labelForm, 'submit');
                   ">
            <button type="button"
                    class="text-xs bg-slate-800 text-white px-2 py-1.5 rounded-md hover:bg-slate-700"
                    @click="
                        $refs.labelForm.querySelector('[name=label]').value = customText;
                        htmx.trigger($refs.labelForm, 'submit');
                    ">Set</button>
        </div>
    </template>

    <form x-ref="labelForm" class="hidden"
          hx-post="/spec/section/label"
          hx-target="#spec-header-{{ section_id }}"
          hx-swap="innerHTML">
        <input type="hidden" name="section" value="{{ section_name }}">
        <input type="hidden" name="label" value="">
    </form>

    <span class="w-28 text-right font-semibold text-sm text-slate-900 tabular-nums">{{ format_currency(section_total.total) }}</span>
</div>
