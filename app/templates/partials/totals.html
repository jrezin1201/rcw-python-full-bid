<div class="bg-slate-50 rounded-lg border border-slate-200 px-4 py-3">
    <div class="max-w-2xl mx-auto">
        <!-- Summary Metrics Row -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-3">
            <!-- Grand Total -->
            <div class="bg-slate-800 rounded p-2.5 text-white">
                <p class="text-[10px] uppercase tracking-wide text-slate-300">Total</p>
                <p class="text-lg font-bold">{{ format_currency(bid_state.grand_total) }}</p>
            </div>

            <!-- Total per Unit -->
            <div class="bg-white rounded border border-slate-200 p-2.5">
                <p class="text-[10px] uppercase tracking-wide text-slate-500">Total/Unit</p>
                {% set unit_count = namespace(count=0) %}
                {% for item in bid_state.raw_items %}
                    {% set n = item.name.lower() %}
                    {% if 'count' in n and ('unit' in n or 'bed' in n or 'studio' in n) %}
                        {% set unit_count.count = unit_count.count + item.qty|int %}
                    {% endif %}
                {% endfor %}
                <p class="text-lg font-bold text-slate-900">
                    {% if unit_count.count > 0 %}
                        {{ format_currency(bid_state.grand_total / unit_count.count) }}
                    {% else %}
                        --
                    {% endif %}
                </p>
                {% if unit_count.count > 0 %}
                <p class="text-[10px] text-slate-400">{{ unit_count.count }} units</p>
                {% endif %}
            </div>

            <!-- $/SF -->
            <div class="bg-white rounded border border-slate-200 p-2.5">
                <p class="text-[10px] uppercase tracking-wide text-slate-500">$/SF</p>
                {% set total_sf = namespace(sf=0) %}
                {% for item in bid_state.raw_items %}
                    {% if item.uom == 'SF' %}
                        {% set total_sf.sf = total_sf.sf + item.qty %}
                    {% endif %}
                {% endfor %}
                <p class="text-lg font-bold text-slate-900">
                    {% if total_sf.sf > 0 %}
                        {{ "${:,.2f}".format(bid_state.grand_total / total_sf.sf) }}
                    {% else %}
                        --
                    {% endif %}
                </p>
                {% if total_sf.sf > 0 %}
                <p class="text-[10px] text-slate-400">{{ "{:,.0f}".format(total_sf.sf) }} SF</p>
                {% endif %}
            </div>

            <!-- Total Items -->
            <div class="bg-white rounded border border-slate-200 p-2.5">
                <p class="text-[10px] uppercase tracking-wide text-slate-500">Line Items</p>
                <p class="text-lg font-bold text-slate-900">{{ bid_state.total_items }}</p>
                <p class="text-[10px] text-slate-400">{{ bid_state.section_totals|length }} sections</p>
            </div>
        </div>

        <!-- Section Breakdown -->
        <div>
            <h4 class="text-[10px] font-semibold uppercase tracking-wide text-slate-500 mb-2">Section Breakdown</h4>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                {% for section_total in bid_state.section_totals %}
                <div class="bg-white rounded border border-slate-200 p-2">
                    <p class="text-[10px] text-slate-500 truncate">{{ section_total.section_name }}</p>
                    <p class="text-sm font-semibold text-slate-800">{{ format_currency(section_total.total) }}</p>
                    <p class="text-[10px] text-slate-400">{{ section_total.item_count }} items</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
